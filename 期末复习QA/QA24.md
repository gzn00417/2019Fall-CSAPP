# QA24

###  简述hello从命令行到运行的过程 

1.fork

2.execve

3.load

4.dl_init setjmp等到 _start-(所有C程序的入口点,在ctrl.o中)

5.libc_start_main(系统启动函数，在libc.so,初始化执行环境 调用main执行，处理main返回值，控制返回给内核) 

6.main	

-->exit(0) 或 return 0 终止 

--->bash回收

---

### 信号与异常的区别与联系 ###

**1.异常**

定义：异常就是控制流中的突变，用来响应处理器状态的某些变化

**2.信号**

定义：信号是一条小消息，通知进程系统中发生了一个某种类型的时间

**区别**

信号是软件上的概念，指的是由内核 产生，并由用户态程序响应的事件。

异常是硬件上的概念，指的是 CPU 因执行某些指令而产生的事件，比如常见的除零错误。另外，相对于中断，异常是同步的，中断是异步的；异常是由执行指令产生的，中断则是由硬件产生的。

信号是异步的进程间通讯机制,是在软件层次上对中断机制的一种模拟

**联系**

  1.硬件异常也能产生信号，例如被零除、无效内存引用等。这些条件通常先由内核硬件检测到，然后通知内核。内核将决定产生什么样的信号。





---

### 信号的处理方法有哪几种？

一般有**三种**

1.忽略此信号

2.执行该信号的默认处理动作
每个信号类型都有一个预定义的默认行为
是下面中的一种：

1. 进程终止
2. 进程终止并转储内存
3. 进程停止（挂起）直到被SIGCONT信号重启
4. 进程忽略该信号

3.提供一个信号处理函数，要求内核处理该信号时切换到用户执行这个处理函数，这种方式称为捕捉一个信号.

*ps：信号机制*

 （1）发送信号。发送信号的程序用系统调用kill( )实现；
（2）预置对信号的处理方式。接收信号的程序用signal( )来实现对处理方式的预置；
（3）收受信号的进程按事先的规定完成对相应事件的处理。



*ps2：信号的产生条件*

1. 用户在终端 按下某些键时，终端驱动程序会发送信号给前台进程，例如Ctrl-C产生SIGINT信 号，Ctrl-/产生SIGQUIT信号，Ctrl-Z产生SIGTSTP信号。

2. 硬件异常产生信号，这些条件由硬件检测到并通知内核，然后内核向当前进程发送适当的信号。例如当前进程执行了 除以0的指令，CPU的运算单元会产生异常，内核将这个异常解释为SIGFPE信号发送给进 程。再比如当前进程访问了非法内存地址，，MMU会产生异常，内核将这个异常解释为SIGSEGV信 号发送给进程。

3. 一个进程调用kill(2)函数可以发送信 号给另一个进程。

4. 可以用kill(1)命令发送信号给某个 进程，kill(1)命令也是调用kill(2)函 数实现的，如果不明确指定信号则发送SIGTERM信号，该信号的默认处理动作是终止进程。

5. 当 内核检测到某种软件条件发生时也可以通过信号通知进程，例如闹钟超时产生SIGALRM信 号，向读端已关闭的管道写数据时产生SIGPIPE信号。
   													
**信号的捕获过程**

   ![img](https://images2015.cnblogs.com/blog/899685/201701/899685-20170112142603666-965135331.png)

---

###  批处理、作业、任务、程序、进程？

**批处理(**Batch)，也称为批处理[脚本](https://baike.baidu.com/item/脚本)。[顾名思义](https://baike.baidu.com/item/顾名思义/1481950)，批处理就是对某对象进行批量的处理，通常被认为是一种简化的[脚本语言](https://baike.baidu.com/item/脚本语言/1379708)，它应用于[DOS](https://baike.baidu.com/item/DOS)和[Windows](https://baike.baidu.com/item/Windows)系统中。

**作业（job）**是计算机操作者（或是一个叫做作业调度器的程序）交给操作系统的执行单位

**任务**：在多道程序或多进程环境中，要由计算机来完成的基本工作元，它是由控制程序处理的一 个或多个指令序列。

**程序**是一组计算机能识别和执行的指令，

**进程：**是程序的一次执行，进程是可以和别的计算并行执行进程是程序在一个数据集合上运行的过程,它是系统进行资源分配和调度的一个独立单位

**程序与进程之间的区别：**

（1）进程更能真实地描述并发，而程序不能。
（2）进程由程序和数据两部分组成，进程是竞争计算机系统有限资源的基本单位，也是进程处理机调度的基本单位。
（3）程序是静态的概念；进程是程序在处理机上一次执行的过程，是动态的概念。
（4）进程有生存周期，有诞生有消亡。是短暂的；而程序是相对长久的。
（5）一个程序可以作为多个进程的运行程序；一个进程也可以运行多个程序。
（6）进程具有创建其他进程的功能；而程序没有。

**作业与进程的区别：**

​    一个进程是一个程序对某个数据集的执行过程，是分配资源的基本单位。作业是用户需要计算机完成的某项任务，是要求计算机所做工作的集合。一个作业的完成要经过作业提交、作业收容、作业执行和作业完成4个阶段。而进程是对已提交完毕的程序所执行过程的描述，是资源分配的基本单位。其主要区别如下。
   （1）作业是用户向计算机提交任务的任务实体。在用户向计算机提交作业后，系统将它放入外存中的作业等待队列中等待执行。而进程则是完成用户任务的执行实体，是向系统申请分配资源的基本单位。任一进程，只要它被创建，总有相应的部分存在于内存中。
   （2）一个作业可由多个进程组成，且必须至少由一个进程组成，反过来则不成立。
   （3）作业的概念主要用在批处理系统中，像UNIX这样的分时系统中就没有作业的概念。而进程的概念则用在几乎所有的多道程序系统中。

**作业、进程和程序之间的联系：**

​    一个作业通常包括程序、数据和操作说明书3部分。每一个进程由PCB、程序和数据集合组成。这说明程序是进程的一部分，是进程的实体。因此，一个作业可划分为若干个进程来完成，而每一个进程有其实体————程序和数据集合。 

---

### 异步异常/中断与信号的处理有何不同？

 **异常处理**

 1.当发生异常时，CPU控制单元产生一个硬件出错码。

 2.CPU根据该中断吗找到中断向量表内的对应向量，根据该向量转到中断处理程序。

  3.中断处理程序处理完之后向当前进程发送一个SIG***信号。

4. 若进程定义了相应的信号处理程序则转移到相应的程序执行，若没有，则执行内核定义的操作。

**中断处理**

  1.设备产生中断

 2.PIC（可编程中断控制器）会产生一个对应的中断向量

 3.和中断向量表中的每一个中断向量进行比较，转到对应的中断处理程序

 4.中断处理程序进行保存现场，做相关处理，恢复现场

 5.内核调度，返回用户进程

**信号与中断的相似点**

（1）采用了相同的异步通信方式；
（2）当检测出有信号或中断请求时，都暂停正在执行的程序而转去执行相应的处理程序；
（3）都在处理完毕后返回到原来的断点；
（4）对信号或中断都可进行屏蔽。

 **信号与中断的区别**

 （1）中断有优先级，而信号没有优先级，所有的信号都是平等的；
（2）信号处理程序是在用户态下运行的，而中断处理程序是在核心态下运行；
（3）中断响应是及时的，而信号响应通常都有较大的时间延迟。

---

### 有的中断/异步异常会产生信号？

硬件异常也能产生信号，例如被零除、无效内存引用等。这些条件通常先由内核硬件检测到，然后通知内核。内核将决定产生什么样的信号。
 **下图为异常和函数产生信号的方式以及进程的处理过程**

![](https://images2015.cnblogs.com/blog/899685/201701/899685-20170112142603666-965135331.png)

---

### 信号处理程序与中断处理程序可以各自嵌套与互相嵌套？同一信号/中断同时多次 发生呢？缺省信号可嵌套中断不嵌套

外部中断不支持嵌套处理，内部异常支持嵌套处理，原因是：内部异常程序也是有可能发生越界、越权、缺页的

---



### 一些知识点：

一般的故障类异常-内中断的处理是通过向发生异常的进程发送信号的机制实现异 常处理，可尽快完成在内核态的异常处理过程，因为异常处理过程越长，嵌套执 行异常的可能性越大，而异常嵌套执行会付出较大的代价。但缺页故障不是

Linux用两个32/64位数表示信号与其阻塞 kill函数是终止进程并回收进程 

Linux处理“除法错”异常#DE（类型0）发送SIGFPE信号 Linux用信号处理同步异常，用中断处理异步异常（pushf）

### （*） 延时过程调用与中断服务例程

